<% page_title( t('.header')) %>

<%= render partial: 'progress_bar' %>

<h2 class="mt-3">
  <%= fa_icon t('.header_icon') %>
  <%= t('.header') %>
</h2>

<%= simple_form_for @draft_item, url: wizard_path, method: :put, html: { class:'js-deposit-item' } do |f| %>
  <p class="text-muted"><%= t('required_fields_html') %></p>

  <%= f.input :title,
              label: t('.title'),
              required: true,
              placeholder: t('.title_placeholder') %>

  <%= f.input :alternate_title,
              label: t('.alternate_title'),
              placeholder: t('.alternate_title_placeholder'),
              hint: t('.alternate_title_help') %>

  <%= f.association :type,
      label: t('.type_id'),
      label_method: :translated_name,
      value_method: :id,
      # TODO: Bug in simple form: https://github.com/plataformatec/simple_form/issues/1427
      # include_blank is not allowed with required true, so hack is to set empty prompt?
      # include_blank: false,
      required: true,
      prompt: '',
      hint: t('.type_id_help_html') %>


  <%= f.association :languages,
      label: t('.languages'),
      label_method: :translated_name,
      value_method: :id,
      multiple: true,
      input_html: {
        data: { placeholder: t('.languages_placeholder') },
        class: 'js-select2'
      },
      # TODO: Bug in simple form: https://github.com/plataformatec/simple_form/issues/1427
      # include_blank is not allowed with required true, so hack is to set empty prompt?
      # include_blank: false,
      required: true,
      prompt: '' %>

  <%= f.association :creators,
      label: t('.creators'),
      label_method: :name,
      value_method: :id,
      multiple: true,
      input_html: {
        data: { tags: true, placeholder: t('.creators_placeholder') },
        class: 'js-select2'
      },
      # TODO: Bug in simple form: https://github.com/plataformatec/simple_form/issues/1427
      # include_blank is not allowed with required true, so hack is to set empty prompt?
      # include_blank: false,
      required: true,
      prompt: '',
      hint: t('.creators_help') %>

  <%= f.association :subjects,
      label: t('.subjects'),
      label_method: :name,
      value_method: :id,
      multiple: true,
      input_html: {
        data: { tags: true, placeholder: t('.subjects_placeholder') },
        class: 'js-select2'
      },
      # TODO: Bug in simple form: https://github.com/plataformatec/simple_form/issues/1427
      # include_blank is not allowed with required true, so hack is to set empty prompt?
      # include_blank: false,
      required: true,
      prompt: '',
      hint: t('.subjects_help') %>

  <%= f.input :date_created,
              as: :date,
              label: t('.date_created'),
              order: [:year, :month, :day],
              prompt: {
                day: t('select_a_day'),
                month: t('select_a_month'),
                year: t('select_a_year')
              },
              start_year: Date.today.year - 100,
              end_year: Date.today.year + 1,
              input_html: { class: 'mr-2 mb-2' },
              required: true %>

  <%= f.input :description,
              as: :text,
              label: t('.description'),
              input_html: { rows: '5' },
              placeholder: t('.description_placeholder'),
              required: true %>

  <fieldset>
    <legend class="mb-0">
      <%= t('.community_and_collection') %>
    </legend>
    <small class="mb-3 form-text text-muted">
      <%= t('.community_and_collection_help_html') %>
    </small>
    <div class="form-group">
      <label>
        <span class="text-danger font-weight-bold">*</span>
        <%= t('.community') %>
      </label>
      <%= select_tag 'draft_item[community_id]',
                      options_from_collection_for_select(Community.all, :id, :title),
                      prompt: t('.community_placeholder'),
                      class: 'form-control js-community-select' %>
    </div>
    <div class="form-group">
      <label>
        <span class="text-danger font-weight-bold">*</span>
        <%= t('.collection') %>
      </label>
      <%= select_tag 'draft_item[collection_id]',
                      nil,
                      data: { placeholder: t('.collection_placeholder') },
                      class: 'form-control js-collection-select',
                      disabled: true %>
    </div>
  </fieldset>

  <div id="js-additional-fields-accordion" role="tablist">
    <div class="card">
      <div id="js-heading-additional-fields" class="card-header" role="tab">
        <h5 class="mb-0">
          <a data-toggle="collapse"
              href="#js-collapse-additional-fields"
              aria-expanded="false"
              aria-controls="js-collapse-additional-fields">
            <%= t('.additional_fields') %>
            <%= fa_icon "chevron-down", class: "js-more-less pull-right" %>
          </a>
        </h5>
      </div>

      <div id="js-collapse-additional-fields"
            class="collapse"
            data-parent="#js-additional-fields-accordion"
            role="tabpanel"
            aria-labelledby="js-heading-additional-fields">
        <div class="card-body">
          <%= f.association :contributors,
              label: t('.contributors'),
              label_method: :name,
              value_method: :id,
              multiple: true,
              input_html: {
                data: { tags: true, placeholder: t('.contributors_placeholder') },
                class: 'js-select2'
              },
              include_blank: false,
              hint: t('.contributors_help') %>

          <%= f.association :places,
              label: t('.places'),
              label_method: :name,
              value_method: :id,
              multiple: true,
              input_html: {
                data: { tags: true, placeholder: t('.places_placeholder') },
                class: 'js-select2'
              },
              include_blank: false,
              hint: t('.places_help') %>

          <%= f.association :time_periods,
              label: t('.time_periods'),
              label_method: :name,
              value_method: :id,
              multiple: true,
              input_html: {
                data: { tags: true, placeholder: t('.time_periods_placeholder') },
                class: 'js-select2'
              },
              include_blank: false,
              hint: t('.time_periods_help_html') %>

          <%= f.association :citations,
              label: t('.citations'),
              label_method: :name,
              value_method: :id,
              multiple: true,
              input_html: {
                data: { tags: true, placeholder: t('.citations_placeholder') },
                class: 'js-select2'
              },
              include_blank: false,
              hint: t('.citations_help') %>

          <%= f.input :source,
              label: t('.source'),
              hint: t('.source_help') %>

          <%= f.input :related_item,
              label: t('.related_item'),
              hint: t('.related_item_help') %>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3 pull-right">
    <%= link_to root_path, class: 'btn btn-secondary' do %>
      <%= fa_icon 'ban' %>
      <%= t('cancel') %>
    <% end %>
    <%= f.button :button, type: :submit do %>
      <%= t('items.draft.save_and_continue') %>
      <%= fa_icon 'chevron-right' %>
    <% end %>
  </div>

<% end %>
